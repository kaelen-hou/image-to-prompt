# 性能监控指南

本项目集成了全面的性能监控系统，用于监测和优化 Web 应用性能。

## 🎯 Core Web Vitals 监控

### 自动监控指标

- **LCP (Largest Contentful Paint)**: 最大内容绘制时间
  - 优秀: ≤ 2.5s
  - 需改进: 2.5s - 4.0s  
  - 差: > 4.0s

- **FID (First Input Delay)**: 首次输入延迟
  - 优秀: ≤ 100ms
  - 需改进: 100ms - 300ms
  - 差: > 300ms

- **CLS (Cumulative Layout Shift)**: 累积布局偏移
  - 优秀: ≤ 0.1
  - 需改进: 0.1 - 0.25
  - 差: > 0.25

- **FCP (First Contentful Paint)**: 首次内容绘制
  - 优秀: ≤ 1.8s
  - 需改进: 1.8s - 3.0s
  - 差: > 3.0s

- **TTFB (Time to First Byte)**: 首字节时间
  - 优秀: ≤ 800ms
  - 需改进: 800ms - 1.8s
  - 差: > 1.8s

### 数据收集

- **开发环境**: 指标在浏览器控制台中显示
- **生产环境**: 数据发送至 `/api/analytics/web-vitals` 端点
- **第三方集成**: 支持 Google Analytics 4

## 📊 Bundle 分析工具

### 可用命令

```bash
# 分析所有包 (客户端 + 服务器端)
npm run analyze

# 仅分析客户端包
npm run analyze:browser

# 仅分析服务器端包  
npm run analyze:server
```

### 分析报告

运行分析命令后，会自动在浏览器中打开交互式报告，显示：

- 包大小分布
- 依赖关系图
- 重复依赖检测
- 代码分割效果
- 路由级别的包大小

## 🖥️ 性能监控仪表板

### 访问方式

开发环境中访问: `http://localhost:3000/dev/performance`

### 功能特性

- 实时 Core Web Vitals 监控
- 性能评分计算
- Bundle 分析工具快捷入口
- 性能优化建议
- 历史数据趋势 (计划中)

## 🔧 优化建议

### LCP 优化
- 优化图片: 使用 WebP/AVIF 格式，设置合适尺寸
- 减少服务器响应时间
- 移除不必要的第三方脚本
- 使用 CDN 加速资源加载

### FID 优化
- 代码分割: 使用动态导入减少初始包大小
- 减少主线程工作: 延迟非关键 JavaScript 执行
- 使用 Web Workers 处理计算密集任务
- 优化第三方代码加载

### CLS 优化  
- 为图片和视频设置明确的尺寸属性
- 为 Web 字体预留空间
- 避免在现有内容上方插入内容
- 使用 transform 动画而不是改变布局属性

### 通用优化
- 启用 Gzip/Brotli 压缩
- 使用适当的缓存策略
- 优化关键渲染路径
- 减少不必要的重新渲染

## 📈 监控最佳实践

### 1. 定期检查
- 每次重大更新后运行 Bundle 分析
- 监控性能趋势变化
- 设置性能预算和警报

### 2. A/B 测试
- 对比不同版本的性能表现
- 验证优化措施的有效性

### 3. 真实用户监控
- 关注生产环境的实际数据
- 考虑不同设备和网络条件的影响

### 4. 持续优化
- 基于数据驱动的优化决策
- 保持性能监控的可观测性

## 🚀 集成外部服务

### Google Analytics 4
```javascript
// 已自动配置，确保 gtag 已加载
// 数据会自动发送到 GA4
```

### 自定义端点
```javascript  
// 修改 WebVitals.tsx 中的 sendToAnalytics 函数
// 添加您的自定义分析服务端点
```

## 📱 PWA 性能监控

项目已配置 PWA，包含：
- Service Worker 缓存策略
- 离线支持
- 预缓存关键资源
- 运行时缓存优化

监控 PWA 特定指标：
- 缓存命中率
- 离线可用性
- 安装转化率